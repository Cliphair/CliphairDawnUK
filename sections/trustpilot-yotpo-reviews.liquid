{{ 'component-rating.css' | asset_url | stylesheet_tag }}
<style>
.rating-star {
  --letter-spacing: 0.8;
  --font-size: 1.7;
}

.rating-star {
  --letter-spacing: 0.7;
  --font-size: 1.4;
}

  .icon svg{
    width:10px;
    fill:white;
  }
  
  .yotpo-stars .icon{
    width:20px;
    height:20px;
    display:inline-flex;
    justify-content:center;
    align-items:center;
    background:#dcdce6;
  }

  .yotpo-review{
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .yotpo-stars{
    display: flex;
    gap: 2px;
  }

  .full.filled{
    background:#ac90c1
  }

  .half.filled{
    background: linear-gradient(
      90deg,
      #ac90c1 50%,
      #dcdce6 50%
    );
  }

  .tooltip {
  position: relative;
    display:inline-flex;
}

/* Tooltip text */
.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 0;
  border-radius: 6px;
 
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1000;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}

  .tooltip .tooltiptext {
  width: 120px;
  top: 100%;
  left: 50%;
  margin-left: -60px; /* Use half of the width (120/2 = 60), to center the tooltip */
    margin-top:7px;
    font-size:1rem;
}

  .tooltip .tooltiptext::after {
  content: " ";
  position: absolute;
  bottom: 100%;  /* At the top of the tooltip */
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent black transparent;
}
  
</style>
<!-- TrustBox script -->
<script type="text/javascript" src="//widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js" async></script>
<!-- End TrustBox script -->
<div>

  <div>
    <!-- TrustBox widget - Micro Star -->
<div class="trustpilot-widget" data-locale="en-GB" data-template-id="5419b732fbfb950b10de65e5" data-businessunit-id="4c4c36a300006400050d7196" data-style-height="24px" data-style-width="100%" data-text-color="#414141">
  <a href="https://uk.trustpilot.com/review/cliphair.co.uk" target="_blank" rel="noopener">Trustpilot</a>
</div>
<!-- End TrustBox widget -->
  </div>
  
  |
  
  <a href='#' class='yotpo-review tooltip'>
    <div class='yotpo-stars'>
      {% for i in (1..5) %}
        <span class='yotpo-star icon filled'>{% render'icon-star' %}</span>
      {% endfor %}
    </div>
    <svg width="58" height="16" viewBox="0 0 58 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M3.26899 2.26024L5.39873 8.19371L7.62984 2.26024H10.7975L5.381 16H2.24828L3.85034 11.7427L0 2.26024H3.26899ZM36.7241 2.05019C39.5842 2.05019 41.6695 4.29282 41.6695 7.36276C41.6695 10.4327 39.5842 12.6753 36.7241 12.6753C35.6687 12.6753 34.7798 12.393 34.1015 11.8487L34.0576 11.8128L34.0201 11.7812L34.0201 15.9967H30.9679L30.968 2.26024H33.6668L33.6668 3.28745L33.682 3.26977C34.3471 2.50311 35.3532 2.07883 36.5957 2.05159L36.6613 2.05052L36.7241 2.05019ZM16.3566 2.05019C19.506 2.05019 21.7385 4.24902 21.7385 7.36276C21.7385 10.4628 19.4986 12.6753 16.3566 12.6753C13.1969 12.6753 10.9538 10.4659 10.9538 7.36276C10.9538 4.24592 13.1895 2.05019 16.3566 2.05019ZM26.823 0L26.823 2.26024H29.3346V4.9245L26.823 4.92442L26.823 8.60205C26.823 9.42471 27.2187 9.87723 27.9388 9.90471L27.9739 9.9057L28.0095 9.90604C28.4979 9.90604 28.8678 9.77639 29.1987 9.45498L29.2296 9.42429L29.3119 9.3389H29.3346V12.2777L29.241 12.323C28.7388 12.5657 28.429 12.6753 27.573 12.6753C25.1528 12.6753 23.8239 11.3439 23.7723 8.85824L23.7712 8.78256L23.7708 8.70708L23.7707 4.92442L22.6662 4.9245V2.26024H23.8539L23.8539 0H26.823ZM48.3392 2.05019C51.4887 2.05019 53.7212 4.24902 53.7212 7.36276C53.7212 10.4628 51.4813 12.6753 48.3392 12.6753C45.1796 12.6753 42.9365 10.4659 42.9365 7.36276C42.9365 4.24592 45.1722 2.05019 48.3392 2.05019ZM56.209 9.29517C57.1327 9.29517 57.8815 10.0518 57.8815 10.9852C57.8815 11.9187 57.1327 12.6753 56.209 12.6753C55.2853 12.6753 54.5365 11.9187 54.5365 10.9852C54.5365 10.0518 55.2853 9.29517 56.209 9.29517ZM36.2668 4.81948C34.8918 4.81948 33.9579 5.84799 33.9579 7.36276C33.9579 8.87753 34.8918 9.90604 36.2668 9.90604C37.6598 9.90604 38.5965 8.8806 38.5965 7.36276C38.5965 5.84492 37.6598 4.81948 36.2668 4.81948ZM16.3566 4.81948C14.9767 4.81948 14.0269 5.8532 14.0269 7.36276C14.0269 8.87232 14.9767 9.90604 16.3566 9.90604C17.7184 9.90604 18.6655 8.86922 18.6655 7.36276C18.6655 5.85629 17.7184 4.81948 16.3566 4.81948ZM48.3392 4.81948C46.9594 4.81948 46.0095 5.8532 46.0095 7.36276C46.0095 8.87232 46.9594 9.90604 48.3392 9.90604C49.7011 9.90604 50.6482 8.86922 50.6482 7.36276C50.6482 5.85629 49.7011 4.81948 48.3392 4.81948Z" fill="#0042E4"></path>
    </svg>
    <span class="tooltiptext"><span class='yotpo-score'>0</span> out of 5 start rating on Yotpo</span>
  </a>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function(){
    removeTrustpilotText();
    updateYotpoRating();
  })

  function removeTrustpilotText() {
    const container = document.querySelector('.trustpilot-review'); // Change to your target element
    const checkIframe = setInterval(() => {
        const iframe = container.querySelector('iframe'); // Look inside the specific container
        if (iframe) {
            console.log('Iframe found:', iframe);
            iframe.onload = () => console.log('Iframe has loaded.');
            clearInterval(checkIframe); // Stop checking after finding it
        }
    }, 500);
  }

  function updateYotpoRating(){
    let stars = Array.from(document.getElementsByClassName('yotpo-star'));
    let score = document.querySelector('.yotpo-score');
    let fullStarsLastIndex = null;
    let halfStarsLastIndex = null;
    
    getYotpoReviewScore().then(data => {
      if (data) {
        score.innerText = data.averageScore;
        fullStarsLastIndex = Math.trunc(data.averageScore);
        if (fullStarsLastIndex < 5 && (data.averageScore - fullStarsLastIndex >= 0)){
          halfStarsLastIndex = fullStarsLastIndex + 1;
        }

        stars.forEach((element, index) => {
          if(index + 1 <= fullStarsLastIndex){
            element.classList.add("full");
          }
          if(halfStarsLastIndex && index + 1 == halfStarsLastIndex){
            element.classList.add("half");
          }
        })
      }
    });
  }

  async function getYotpoReviewScore(){
    const url = `https://api.yotpo.com/products/aMREVTSJZfbqjVqxLsKxYMHAmpb94LftONho8TDm/yotpo_site_reviews/bottomline`;

    try {
        const response = await fetch(url, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json"
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();

        if (data.status.code === 200) {
            return {
                averageScore: data.response.bottomline.average_score,
                totalReviews: data.response.bottomline.total_reviews
            };
        } else {
            throw new Error("Invalid response from Yotpo API");
        }
    } catch (error) {
        console.error("Error fetching Yotpo site review score:", error);
       return null;
    }
  }
</script>

{% schema %}
  {
    "name": "Section name",
    "settings": [],
    "presets": [
      {"name": "test"}
    ]
  }
{% endschema %}