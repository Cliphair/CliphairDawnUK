{% if template contains 'product' %}

<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Product",
        "brand": {
            "@type": "Brand",
            "name": {{ product.vendor | json }}
        },
        "sku": {{ product.selected_or_first_available_variant.sku | json }},
        "gtin8": {{ product.selected_or_first_available_variant.sku | json }},
        "description": {{ product.description | strip_html | json }},
        "url":{{ canonical_url | json }},
        "name": {{ product.title | json }},
        {%- if product.featured_image -%}
        "image": "{{ product.featured_image | product_img_url: "grande" | prepend : "https:"}}",
        {%- endif -%}
        "offers": {
            "@type": "Offer",
            "url":{{ canonical_url | json }},
            "price": {{ product.selected_or_first_available_variant.price | money_without_currency | remove: "," }},
            "priceCurrency": "{{ shop.currency }}",
            "availability": "{%- if product.selected_or_first_available_variant.available -%}InStock{%- else -%}OutOfStock{%- endif -%}",
            "itemCondition": "http://schema.org/NewCondition",
            "priceValidUntil": "{{ "now" | date: "%s" | plus: 31556952 | date: "%b %d, %Y" }}"
        }
        {%- if product.metafields.yotpo.reviews_count and product.metafields.yotpo.reviews_count != "0" -%}
            ,"aggregateRating": {
                "@type": "AggregateRating",
                "ratingValue": {{ product.metafields.yotpo.reviews_average }},
                "ratingCount": {{ product.metafields.yotpo.reviews_count }}
            }
        {%- endif -%}
    }
        </script>

{% elsif template contains 'collection' %}
   <script type="application/ld+json">
        [
            {
                "@context" : "http://schema.org",
                "@type": "CollectionPage",
                "name": "{{ collection.title}}",
                "url": "{{ shop.url | append: collection.url }}",
                "image": "{{ collection.image | img_url: "master" }}"
            }{% if collection.products != empty %},{% endif %}
            {% for product in collection.products %}
            {
                "@context" : "http://schema.org",
                "@type" : "Product",
                "brand": {
		            "@type": "Brand",
		            "name": {{ product.vendor | json }}
		     },
		     "sku": {{ product.selected_or_first_available_variant.sku | json }},
		     "description": {{ product.description | strip_html | json }},
                "name" : "{{ product.title | strip_newlines | strip_html | escape_once | replace: "\", "\\\\\\\\" }}",
                "image": "{{ product.featured_image.src | img_url: "master" | prepend : "https:" }}",
                "url" : "{{ shop.url | append: "/products/" | append: product.handle }}",
                "offers" : {
                    "@type" : "Offer",
                    "url" : "{{ shop.url | append: "/products/" | append: product.handle }}",
                    "price" : {{ product.price | money_without_currency | split: "" | reverse | join: "" | remove_first: "00." | split: "" | reverse | join: "" | replace: ",", "" }},
                    "priceCurrency" : "{{ shop.currency }}",
                    "availability": "{%- if product.selected_or_first_available_variant.available -%}InStock{%- else -%}OutOfStock{%- endif -%}"
                }
                 {%- if product.metafields.yotpo.reviews_count and product.metafields.yotpo.reviews_count != "0" -%}
		            ,"aggregateRating": {
		                "@type": "AggregateRating",
		                "ratingValue": {{ product.metafields.yotpo.reviews_average }},
		                "ratingCount": {{ product.metafields.yotpo.reviews_count }}
		            }
		      {%- endif -%}
            }{% unless forloop.last %}, {% endunless %}
            {% endfor %}
        ]
    </script>

{% elsif template contains 'page' %}

{% elsif template contains 'article' %}

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "articleBody": "{{ article.content | strip_html | strip_newlines | escape }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ shop.url }}{{ page.url }}"
  },
  "headline": "{{ article.title }}",
  {% if article.excerpt != blank %}
    "description": "{{ article.excerpt | strip_html | strip_newlines | escape }}",
  {% endif %}
  {% if article.image %}
    {% assign image_size = article.image.width | append: 'x' %}
    "image": [
      "https:{{ article | img_url: image_size }}"
    ],
  {% endif %}
  "datePublished": "{{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' }}",
  "dateCreated": "{{ article.created_at | date: '%Y-%m-%dT%H:%M:%SZ' }}",
  "dateModified": "{{ article.updated_at | date: '%Y-%m-%dT%H:%M:%SZ' }}",
  "author": {
    "@type": "Person",
    "name": "{{ article.author }}"
  },
  "publisher": {
    "@type": "Organization",
    {% if settings.share_image %}
      {% assign image_size = settings.share_image.width | append: 'x' %}
      "logo": {
        "@type": "ImageObject",
        "height": "{{ settings.share_image.height }}",
        "url": "https:{{ settings.share_image | img_url: image_size }}",
        "width": "{{ settings.share_image.width }}"
      },
    {% elsif article.image %}
      {% assign image_size = article.image.width | append: 'x' %}
      "logo": {
        "@type": "ImageObject",
        "height": "{{ article.image.height }}",
        "url": "https:{{ article.image | img_url: image_size }}",
        "width": "{{ article.image.width }}"
      },
    {% endif %}
    "name": "{{ shop.name }}"
  }
}
</script>



{% endif %}